{% extends "base.html" %} {% load static %} {% block head %}
<link rel="stylesheet" href="{% static 'admin_and_employee.css' %}" />
<link rel="stylesheet" href="{% static 'timetable.css' %}" />
{% endblock %} {% block content %}
<div class="container">
  <h1 class="page-title">STWÓRZ PLAN ZAJĘĆ</h1>
    <div class="time-intervals-fieldset">
    <form method="post">
      {% csrf_token %}
      <legend>Przedziały Godzinowe</legend>
      <div class="time-intervals">
        {% for interval in intervals %}
        <div class="time-interval">
          {{ forloop.counter }}
          <input
            class="time-input"
            type="time"
            name="startTime[]"
            {% if interval %}
            value="{{ interval.start_time|time:'H:i' }}"
            {% endif %}
          />
          <span>-</span>
          <input
            class="time-input"
            type="time"
            name="endTime[]"
            {% if interval %}
            value="{{ interval.end_time|time:'H:i' }}"
            {% endif %}
          />
          <button
            type="button"
            onclick="clearTime(this)"
            class="removeIntervalButton"
          >
            x
          </button>
        </div>
        {% endfor %}
      </div>
      <button
        class="btn button-orange save-button"
        type="submit"
        name="update_intervals"
      >
        Zapisz
      </button>
    </form>
    </div>
    <legend>Sale</legend>
    <table>
      {% for classroom in classrooms %}
      <tr>
        <td class="classroom-table">
          <div class="classroom-name">{{ classroom.name }}</div>
          <button
            class="btn btn-outline-primary button-classroom"
            onclick="editClassroom('{{ classroom.id }}', '{{ classroom.name }}')"
          >
            Edytuj
          </button>
          <form method="post">
            {% csrf_token %}
            <input
              type="hidden"
              name="classroom_id"
              value="{{ classroom.id }}"
            />
            <button
              class="btn btn-outline-danger button-classroom"
              type="submit"
              name="delete_classroom"
            >
              Usuń
            </button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </table>
    <form method="post">
      {% csrf_token %}
      <input type="hidden" name="classroom_id" id="classroom_id" />
      <label for="name">Dodaj/Edytuj salę:</label>
      <input type="text" id="name" name="name" required />
      <button class="btn button-orange" type="submit" name="add_edit_classroom">
        Zapisz
      </button>
    </form>
    <script>
      function editClassroom(id, name) {
        document.getElementById("classroom_id").value = id;
        document.getElementById("name").value = name;
      }
    </script>

    <legend>Dostępność lektorów i sal</legend>
    <form method="post">
      {% csrf_token %}
      <table class="timetable">
        <thead>
          <tr>
            <th>Godzina</th>
            <th>Poniedziałek</th>
            <th>Wtorek</th>
            <th>Środa</th>
            <th>Czwartek</th>
            <th>Piątek</th>
          </tr>
        </thead>
        <tbody>
          {% for interval in intervals %}
            {% if interval %}
            <tr>
              <td>
                {{ interval.start_time|time:"H:i" }} - {{ interval.end_time|time:"H:i" }}
              </td>
              {% for day in days %}
              <td>
                <div class="dropdown">
                  <button type="button" class="dropdown-toggle">Dostępne sale</button>
                  <div class="dropdown-menu">
                    {% for classroom in classrooms %}
                    <label class="classroom-avability-checkbox">
                      <input
                        type="checkbox"
                        name="availability-classroom-{{ day }}-{{ interval.id }}"
                        value="{{ classroom.id }}"
                        {% for availability in availability_list %}
                          {% if availability.day == day and availability.time_interval_id == interval.id and availability.classroom_id == classroom.id %}
                            checked
                          {% endif %}
                        {% endfor %}
                      />
                      {{ classroom.name }}
                    </label>
                    {% endfor %}
                  </div>
                </div>
                <div class="dropdown">
                  <button type="button" class="dropdown-toggle">Dostępni lektorzy</button>
                  <div class="dropdown-menu">
                    {% for employee in employees %}
                    <label class="employee-avability-checkbox">
                      <input
                        type="checkbox"
                        name="availability-employee-{{ day }}-{{ interval.id }}"
                        value="{{ employee.id }}"
                        {% for availability in availability_list %}
                          {% if availability.day == day and availability.time_interval_id == interval.id and availability.employee_id == employee.id %}
                            checked
                          {% endif %}
                        {% endfor %}
                      />
                      {{ employee.user.last_name }}
                    </label>
                    {% endfor %}
                  </div>
                </div>
              </td>
              {% endfor %}
            </tr>
            {% endif %}
          {% endfor %}
        </tbody>
      </table>
      <button type="submit" name="update_availability">Zapisz dostępność</button>
    </form>
    

    <script src="/static/js/clear_time.js"></script>
    <script src="/static/js/avability_table.js"></script>
  </div>

<table class="timetable">
  <thead>
    <tr>
      <th>Godzina</th>
      <th>Poniedziałek</th>
      <th>Wtorek</th>
      <th>Środa</th>
      <th>Czwartek</th>
      <th>Piątek</th>
    </tr>
  </thead>
  <tbody>
    {% for hour in hours %}
    <tr>
      <td>{{ hour }}:00 - {{ hour|add:1 }}:00</td>
      {% for day in days %}
      <td>
        {% for lesson in schedule %} 
        {% if lesson.0 == day and not lesson.1.hour > hour and lesson.2.hour > hour %}
        <div class="lesson" style="background-color: #add8e6">
          <strong>{{ lesson.3 }}</strong><br />
          {{ lesson.4 }}<br />
          Sala: {{ lesson.5 }}
          <br /><small>Od {{ lesson.1.hour }}:00</small>
          <small>Do {{ lesson.2.hour }}:00</small>
        </div>
        {% endif %} {% endfor %}
      </td>
      {% endfor %}
    </tr>
    {% endfor %}
  </tbody>
</table>
</div>
  {% endblock %}

